name: Link issue
on:
  issues:
    types: [labeled, unlabeled]
env:
  REPO_TOKEN:   ${{ secrets.WISE_CD_REPO_TOKEN }}
  ORGANIZATION: wisemonkeys-co 
  PRODUCT:      wise-billing
  PROJECT_ID:   1
  GH_TOKEN:     ${{ secrets.GITHUB_TOKEN }}
  GH_REPO:      ${{ github.repository }}
  ISSUE_NUMBER: ${{ github.event.issue.number }}
  ISSUE_TITLE:  ${{ github.event.issue.title }}
  LABEL:        ${{ github.event.label.name }}
  ACTION:       ${{ github.event.action }}
  
jobs:  
  link:    
    name: Link sub Issue
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4   
      - id: labeled  
        if: github.event_name == 'labeled' &&  ! contains(fromJSON('["bug", "enhancement"]'), github.event.label.name ) 
        run: | 
         echo "Buit in label"
         echo "event name is:" ${{ github.event_name }} 
         echo "event type is:" ${{ github.event.action }} 
         echo "issue: "$ISSUE_NUMBER
         echo "repo:  "$LABEL
         scripts/update-task.sh $REPO_TOKEN add $ISSUE_NUMBER $LABEL
      - id: unlabeled
        if: github.event_name == 'unlabeled' &&  ! contains(fromJSON('["bug", "enhancement"]'), github.event.label.name )      
        run: | 
         echo "Buit in label"
         echo "event name is:" ${{ github.event_name }} 
         echo "event type is:" ${{ github.event.action }} 
         echo "issue: "$ISSUE_NUMBER
         echo "repo:  "$LABEL
         scripts/update-task.sh $REPO_TOKEN del $ISSUE_NUMBER $LABEL
